- DCE/RPC is most commonly used to interact with Windows network services. 
- MS-RPC

### rpcclient
* User accounts on the domain
```bash
# Always try null session and guest account
$ rpcclient $IP -U"%" -c "lsaquery"
$ rpcclient $IP -U"guest%" -c "lsaquery"
Domain Name: VAULT
Domain Sid: S-1-5-21-537427935-490066102-1511301751

$ for x in {500..550};do rpcclient $IP -U"guest%" -c "lookupsids S-1-5-21-537427935-490066102-1511301751-$x"; done
S-1-5-21-537427935-490066102-1511301751-500 VAULT\Administrator (1)
S-1-5-21-537427935-490066102-1511301751-501 VAULT\Guest (1) 
S-1-5-21-537427935-490066102-1511301751-502 VAULT\krbtgt (1)
...[snip]...

rpcclient $> lookupnames Administrator
Administrator S-1-5-21-537427935-490066102-1511301751-500 (User: 1)
```

### rpcdump
- Enumerate pipes
- ncacn_np : named pipes
- ncacn_ip_tcp : TCP/IP

```bash
$ rpcdump.py 10.11.1.5

Impacket v0.9.24.dev1+20210704.162046.29ad5792 - Copyright 2021 SecureAuth Corporation                                
                                                           
[*] Retrieving endpoint list from 10.11.1.5    
Protocol: [MS-MSRP]: Messenger Service Remote Protocol                                                                
Provider: msgsvc.dll                                       
UUID    : 5A7B91F8-FF00-11D0-A9B2-00C04FB6E6FC v1.0 Messenger Service
Bindings:                                                  
          ncadg_ip_udp:10.11.1.5[1028]
          ncacn_np:\\ALICE[\PIPE\msgsvc]   
          ncacn_np:\\ALICE[\PIPE\srvsvc]                   
          ncalrpc:[keysvc]
          ncacn_np:\\ALICE[\pipe\keysvc]                   
          ncalrpc:[trkwks]               
          ncacn_np:\\ALICE[\pipe\trkwks]               
          ncacn_np:\\ALICE[\PIPE\SECLOGON] 
          ncacn_np:\\ALICE[\PIPE\wkssvc]
          ncalrpc:[AudioSrv]
          ncacn_np:\\ALICE[\PIPE\atsvc]
          ncacn_ip_tcp:10.11.1.5[1025]
          ncalrpc:[OLE3]

Protocol: N/A
Provider: schedsvc.dll
UUID    : 0A74EF1C-41A4-4E06-83AE-DC74FB1CDD53 v1.0
Bindings:
          ncacn_np:\\ALICE[\PIPE\atsvc]
          ncacn_ip_tcp:10.11.1.5[1025]
          ncalrpc:[OLE3]

Protocol: [MS-TSCH]: Task Scheduler Service Remoting Protocol
Provider: taskcomp.dll
UUID    : 378E52B0-C0A9-11CF-822D-00AA0051E40F v1.0
Bindings:
          ncacn_np:\\ALICE[\PIPE\atsvc]
          ncacn_ip_tcp:10.11.1.5[1025]
          ncalrpc:[OLE3]

Protocol: [MS-TSCH]: Task Scheduler Service Remoting Protocol
Provider: taskcomp.dll
UUID    : 1FF70682-0A51-30E8-076D-740BE8CEE98B v1.0
Bindings:
          ncacn_np:\\ALICE[\PIPE\atsvc]
          ncacn_ip_tcp:10.11.1.5[1025]
          ncalrpc:[OLE3]

[*] Received 22 endpoints.
```

### rpcmap
- Brute force pipes

```bash
$ rpcmap.py 'ncacn_ip_tcp:10.11.1.5[1025]' -brute-uuids -brute-opnums -auth-level 1 -opnum-max 5

Impacket v0.9.24.dev1+20210704.162046.29ad5792 - Copyright 2021 SecureAuth Corporation
                                                           
Procotol: N/A
Provider: N/A                                              
UUID: 00000001-0000-0000-C000-000000000046 v0.0
Opnums 0-5: RPC_E_INVALID_HEADER - OLE received a packet with an invalid header.   

Protocol: [MS-DCOM]: Distributed Component Object Model (DCOM) Remote
Provider: N/A                                  
UUID: 00000131-0000-0000-C000-000000000046 v0.0
Opnums 0-5: RPC_E_INVALID_HEADER - OLE received a packet with an invalid header.

...[snip]...

Protocol: [MS-WMI]: Windows Management Instrumentation Remote Protocol
Provider: N/A
UUID: 027947E1-D731-11CE-A357-000000000001 v0.0
Opnums 0-5: RPC_E_INVALID_HEADER - OLE received a packet with an invalid header.

Protocol: [MS-RPCE]: Remote Management Interface
Provider: rpcrt4.dll
UUID: AFA8BD80-7D8A-11C9-BEF4-08002B102989 v1.0
Opnum 0: success
Opnum 1: rpc_x_bad_stub_data
Opnum 2: success
Opnum 3: success
Opnum 4: rpc_x_bad_stub_data
Opnum 5: nca_s_op_rng_error (opnum not found)
```
